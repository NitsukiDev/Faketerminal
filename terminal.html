<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fake NFC Termin√°l</title>
<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#111;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  height:100vh;
  text-align:center;
}
.screen{display:none;flex-direction:column;gap:15px;}
.activeScreen{display:flex;}
input, button{
  padding:15px;
  font-size:18px;
  border:none;
  border-radius:8px;
}
button{cursor:pointer;}
.primary{background:#00c851;color:#fff;}
.danger{background:#ff4444;color:#fff;}
.lights{display:flex;justify-content:center;gap:10px;}
.light{
  width:15px;
  height:15px;
  border-radius:50%;
  background:#003300;
}
.activeLight{background:#00ff00;}
#pinInput{
  width:200px;
  letter-spacing:8px;
  text-align:center;
  background:#000;
  color:#0f0;
  font-size:28px;
  border:2px solid #0f0;
}
#resultIcon{font-size:80px;}
.hidden{display:none!important;}
</style>
</head>

<body>

<!-- MENU -->
<div id="menu" class="screen activeScreen">
  <h1>üí≥ Termin√°l</h1>
  <input type="number" id="amountInput" placeholder="Zadejte ƒç√°stku (CZK)">
  <label><input type="checkbox" id="pinCheckbox"> Vy≈æadovat PIN</label>
  <label><input type="checkbox" id="rejectCheckbox"> Zam√≠tnout platbu</label>
  <button id="startBtn" class="primary">Spustit termin√°l</button>
</div>

<!-- TERMIN√ÅL -->
<div id="terminal" class="screen">
  <h2 id="amountDisplay"></h2>
  <p id="statusText">P≈ôilo≈æte kartu k telefonu‚Ä¶</p>
  <div class="lights">
    <div class="light"></div>
    <div class="light"></div>
    <div class="light"></div>
    <div class="light"></div>
  </div>
</div>

<!-- PIN -->
<div id="pinScreen" class="screen hidden">
  <h2 id="pinTitle">Zadejte PIN</h2>
  <h3 id="pinAmount"></h3>
  <input id="pinInput" maxlength="4" type="password" inputmode="numeric">
  <button id="confirmPin" class="primary">Potvrdit</button>
  <button id="cancelPin" class="danger">Zru≈°it</button>
</div>

<!-- V√ùSLEDEK -->
<div id="resultScreen" class="screen hidden">
  <div id="resultIcon">‚ùå</div>
  <h2 id="resultText"></h2>
</div>

<audio id="beep" src="TerminalBeep.mp3"></audio>

<script>
let reject = false
let requirePin = false
let amount = 0
function sleep(ms){ return new Promise(r => setTimeout(r, ms)) }

// UI refs
const menu = document.getElementById("menu")
const terminal = document.getElementById("terminal")
const pinScreen = document.getElementById("pinScreen")
const resultScreen = document.getElementById("resultScreen")

const startBtn = document.getElementById("startBtn")
const pinCheckbox = document.getElementById("pinCheckbox")
const rejectCheckbox = document.getElementById("rejectCheckbox")
const amountInput = document.getElementById("amountInput")

const lights = document.querySelectorAll(".light")
const statusText = document.getElementById("statusText")
const amountDisplay = document.getElementById("amountDisplay")
const confirmPin = document.getElementById("confirmPin")
const cancelPin = document.getElementById("cancelPin")
const resultIcon = document.getElementById("resultIcon")
const resultText = document.getElementById("resultText")
const pinInput = document.getElementById("pinInput")
const pinAmount = document.getElementById("pinAmount")

const beepSound = document.getElementById("beep")

// NFC init
async function startNFC(){
  try{
    const ndef = new NDEFReader()
    await ndef.scan()
    ndef.onreading = async () => {
      beepSound.play()
      navigator.vibrate(120)
      if(requirePin){
        await loadCardThenPIN()
      }else{
        await processPayment()
      }
    }
  }catch(e){
    statusText.textContent = "NFC chyba"
  }
}

// Launch terminal
startBtn.onclick = () => {
  if(amountInput.value <= 0) return
  reject = rejectCheckbox.checked
  requirePin = pinCheckbox.checked
  amount = amountInput.value

  menu.classList.remove("activeScreen")
  terminal.classList.add("activeScreen")
  amountDisplay.textContent = amount + " CZK"
  startNFC()
}

async function loadCardThenPIN(){
  statusText.textContent = "Naƒç√≠t√°n√≠ karty‚Ä¶"
  await sleep(2000)
  showPinScreen()
}

async function processPayment(){
  statusText.textContent = "Zpracov√°v√°m‚Ä¶"
  for(let i=0;i<lights.length;i++){
    lights[i].classList.add("activeLight")
    await sleep(250)
  }
  for(let l of lights) l.classList.remove("activeLight")

  await paymentAnimation()
}

async function paymentAnimation(){
  const steps = ["P≈ôij√≠m√°m‚Ä¶","Odes√≠l√°m‚Ä¶","P≈ôij√≠m√°m‚Ä¶","Odes√≠l√°m‚Ä¶"]
  for(const step of steps){
    statusText.textContent = step
    await sleep(700)
  }
  finishPayment()
}

function finishPayment(){
  showResult(!reject)
  setTimeout(()=>{cleanupAndReturn()},4000)
}

// PIN UI actions
confirmPin.onclick = async () => {
  hidePinScreen()
  await processPayment()
}
cancelPin.onclick = () => {
  showResult(false,"Platba Zam√≠tnuta","Nedostatek z≈Østatku")
  setTimeout(()=>cleanupAndReturn(),4000)
}

function showPinScreen(){
  pinAmount.textContent = amount + " CZK"
  terminal.classList.remove("activeScreen")
  pinScreen.classList.remove("hidden")
  pinScreen.classList.add("activeScreen")
  pinInput.value = ""
}
function hidePinScreen(){
  pinScreen.classList.remove("activeScreen")
  pinScreen.classList.add("hidden")
}

function showResult(success,msgCustom,descCustom){
  terminal.classList.remove("activeScreen")
  pinScreen.classList.add("hidden")

  resultScreen.classList.remove("hidden")
  resultScreen.classList.add("activeScreen")

  if(success){
    resultIcon.textContent = "‚úîÔ∏è"
    resultText.textContent = "Schv√°leno"
  }else{
    resultIcon.textContent = "‚ùå"
    resultText.textContent = msgCustom || "Platba Zam√≠tnuta, Nedostatek z≈Østatku"
  }
}

function cleanupAndReturn(){
  resultScreen.classList.remove("activeScreen")
  resultScreen.classList.add("hidden")
  terminal.classList.remove("activeScreen")
  pinScreen.classList.add("hidden")

  menu.classList.add("activeScreen")
}
</script>

</body>
</html>
