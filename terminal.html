<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>üí≥ Fake NFC Termin√°l</title>
<style>
:root{
  --bg:#0b0c0d;
  --panel:#0f1213;
  --muted:#9aa2a8;
  --accent:#00b050;
  --danger:#d04b4b;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:linear-gradient(180deg,#070808,#111314);color:#fff;display:flex;align-items:center;justify-content:center;padding:18px}
.app{width:100%;max-width:420px;background:var(--panel);border-radius:12px;padding:18px;box-shadow:0 12px 30px rgba(0,0,0,.6)}
h1{margin:0 0 10px;font-size:20px;text-align:center}
.row{display:flex;gap:10px;align-items:center;justify-content:center;margin-bottom:8px}
label{font-size:14px;color:var(--muted)}
input[type=number]{width:140px;padding:10px;border-radius:8px;border:1px solid #1a1c1d;background:#080909;color:#fff;font-size:16px}
.controls{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:8px}
.btn{padding:10px 14px;border-radius:8px;border:none;font-weight:700;cursor:pointer}
.btn.primary{background:var(--accent);color:#02260f}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,.06);color:var(--muted)}
.small{font-size:13px;color:var(--muted);text-align:center;margin-top:8px}
.screen{display:none;flex-direction:column;align-items:center;gap:12px}
.activeScreen{display:flex}
.amount{font-size:28px;font-weight:800}
.status{font-size:18px;color:var(--muted);min-height:28px;text-align:center}
.lights{display:flex;gap:10px;margin-top:6px}
.light{width:18px;height:18px;border-radius:50%;background:#032205;box-shadow:inset 0 -2px 6px rgba(0,0,0,.6)}
.light.on{background:linear-gradient(180deg,#17ff5f,#00a63c);box-shadow:0 0 12px rgba(0,170,80,.9)}
.pinScreen{display:flex;flex-direction:column;align-items:center;gap:10px}
.pinTitle{font-weight:700}
.pinAmount{color:var(--muted)}
.pinInput{width:200px;padding:10px;background:#000;border-radius:8px;border:1px solid #111;color:#0f0;font-size:26px;text-align:center;letter-spacing:8px}
.numpad{display:grid;grid-template-columns:repeat(3,70px);gap:8px;margin-top:6px}
.key{width:70px;height:50px;border-radius:8px;background:#121516;border:none;color:#fff;font-size:20px;cursor:pointer}
.resultScreen{display:flex;flex-direction:column;align-items:center;gap:10px}
.resultIcon{font-size:72px}
.resultText{font-weight:800;font-size:20px;text-align:center}
.hidden{display:none}
.footerLinks{display:flex;justify-content:space-between;width:100%;margin-top:10px;color:var(--muted);font-size:13px}
.linkBtn{background:transparent;border:0;color:var(--muted);cursor:pointer}
</style>
</head>
<body>
<div class="app" role="application" aria-label="Fake NFC termin√°l">

  <div id="menu" class="screen activeScreen" aria-hidden="false">
    <h1>üí≥ Fake NFC Termin√°l</h1>
    <div class="row">
      <label for="amount">ƒå√°stka</label>
      <input id="amount" type="number" min="1" value="30" inputmode="numeric" />
    </div>
    <div class="row">
      <label><input id="requirePin" type="checkbox"> Vy≈æadovat PIN</label>
    </div>
    <div class="row">
      <label><input id="rejectOnce" type="checkbox"> Zam√≠tnout tuto platbu (jednor√°zovƒõ)</label>
    </div>
    <div class="controls">
      <button id="startBtn" class="btn primary">Spustit termin√°l</button>
      <button id="resetBtn" class="btn ghost">Reset</button>
    </div>
    <div class="small">Pro NFC: Chrome na Androidu. P≈ôilo≈æ kartu ke zadn√≠ stranƒõ telefonu.</div>
  </div>

  <div id="terminal" class="screen" aria-hidden="true">
    <div class="amount" id="amountDisplay">0 CZK</div>
    <div class="status" id="statusText">P≈ôilo≈æte kartu k zadn√≠ stranƒõ telefonu</div>
    <div class="lights" id="lights">
      <div class="light"></div><div class="light"></div><div class="light"></div><div class="light"></div>
    </div>
    <div class="footerLinks">
      <button id="stopBtn" class="linkBtn">Zastavit</button>
      <button id="backBtn" class="linkBtn">Zpƒõt do nastaven√≠</button>
    </div>
  </div>

  <div id="pinScreen" class="pinScreen screen" aria-hidden="true">
    <div class="pinTitle">üîí Zadejte PIN</div>
    <div class="pinAmount" id="pinAmount">30 CZK</div>
    <input id="pinInput" class="pinInput" type="password" inputmode="numeric" maxlength="4" />
    <div class="numpad" id="numpad">
      <button class="key">1</button><button class="key">2</button><button class="key">3</button>
      <button class="key">4</button><button class="key">5</button><button class="key">6</button>
      <button class="key">7</button><button class="key">8</button><button class="key">9</button>
      <button class="key" id="backKey">‚Üê</button><button class="key">0</button><button class="key" id="clearKey">C</button>
    </div>
    <div class="controls">
      <button id="confirmPin" class="btn primary">‚úÖ Pokraƒçovat</button>
      <button id="cancelPin" class="btn ghost">‚ùå Zru≈°it</button>
    </div>
  </div>

  <div id="result" class="resultScreen screen" aria-hidden="true">
    <div id="resultIcon" class="resultIcon"> </div>
    <div id="resultText" class="resultText"></div>
  </div>

  <audio id="beep" src="TerminalBeep.mp3" preload="auto"></audio>
</div>

<script>
let reader = null
let inProcess = false
const startBtn = document.getElementById('startBtn')
const resetBtn = document.getElementById('resetBtn')
const amountInput = document.getElementById('amount')
const amountDisplay = document.getElementById('amountDisplay')
const requirePin = document.getElementById('requirePin')
const rejectOnce = document.getElementById('rejectOnce')
const menu = document.getElementById('menu')
const terminal = document.getElementById('terminal')
const statusText = document.getElementById('statusText')
const lights = Array.from(document.querySelectorAll('.light'))
const pinScreen = document.getElementById('pinScreen')
const pinAmount = document.getElementById('pinAmount')
const pinInput = document.getElementById('pinInput')
const numpad = document.getElementById('numpad')
const confirmPin = document.getElementById('confirmPin')
const cancelPin = document.getElementById('cancelPin')
const result = document.getElementById('result')
const resultIcon = document.getElementById('resultIcon')
const resultText = document.getElementById('resultText')
const stopBtn = document.getElementById('stopBtn')
const backBtn = document.getElementById('backBtn')
const beep = document.getElementById('beep')

function sleep(ms){return new Promise(r=>setTimeout(r,ms))}

startBtn.addEventListener('click',async ()=>{
  amountDisplay.textContent = (Number(amountInput.value)||0) + ' CZK'
  menu.classList.remove('activeScreen'); menu.classList.add('hidden')
  terminal.classList.add('activeScreen'); terminal.setAttribute('aria-hidden','false')
  statusText.textContent = 'Inicializuji NFC...'
  await startScan()
})

resetBtn.addEventListener('click',()=>{
  amountInput.value = 30
  requirePin.checked = false
  rejectOnce.checked = false
})

stopBtn.addEventListener('click',()=>{
  stopScan()
  statusText.textContent = 'Skenov√°n√≠ zastaveno'
})

backBtn.addEventListener('click',()=>{
  stopScan()
  terminal.classList.remove('activeScreen'); terminal.classList.add('hidden'); terminal.setAttribute('aria-hidden','true')
  menu.classList.add('activeScreen'); menu.classList.remove('hidden')
})

async function startScan(){
  if(!('NDEFReader' in window)){statusText.textContent = 'Tento prohl√≠≈æeƒç nepodporuje NFC'; return}
  try{
    reader = new NDEFReader()
    await reader.scan()
    statusText.textContent = 'P≈ôilo≈æte kartu...'
    reader.onreadingerror = ()=>{statusText.textContent = 'Chyba ƒçten√≠ NFC'}
    reader.onreading = async ()=> {
      if(inProcess) return
      inProcess = true
      if(beep){try{beep.currentTime = 0; beep.play()}catch(e){}}
      if(navigator.vibrate) navigator.vibrate([80,30,80])
      const amount = (Number(amountInput.value)||0)
      if(requirePin.checked){
        statusText.textContent = 'Naƒç√≠t√°n√≠ karty'
        await sleep(2000)
        showPinPad(amount)
      } else {
        await runSequenceAndFinish(!rejectOnce.checked, rejectOnce.checked)
      }
    }
  }catch(e){
    statusText.textContent = 'Nelze spustit NFC. Zkontrolujte Chrome a povolen√≠ NFC.'
  }
}

function stopScan(){
  if(reader){
    try{reader.onreading = null; reader.onreadingerror = null}catch(e){}
    reader = null
  }
}

function showPinPad(amount){
  terminal.classList.remove('activeScreen'); terminal.classList.add('hidden'); terminal.setAttribute('aria-hidden','true')
  pinAmount.textContent = (amount||0) + ' CZK'
  pinInput.value = ''
  pinInput.setAttribute('inputmode','numeric')
  pinScreen.classList.add('activeScreen'); pinScreen.setAttribute('aria-hidden','false')
  pinInput.focus()
}

numpad.addEventListener('click',(ev)=>{
  const t = ev.target
  if(!t.classList.contains('key')) return
  const v = t.textContent.trim()
  if(v === 'C'){ pinInput.value = ''; return }
  if(v === '‚Üê'){ pinInput.value = pinInput.value.slice(0,-1); return }
  if(/\d/.test(v) && pinInput.value.length < 4){ pinInput.value += v }
})

confirmPin.addEventListener('click',async ()=>{
  if(pinInput.value.length < 4){
    statusText.textContent = 'PIN mus√≠ m√≠t 4 ƒç√≠slice'
    return
  }
  pinScreen.classList.remove('activeScreen'); pinScreen.classList.add('hidden'); pinScreen.setAttribute('aria-hidden','true')
  const wasRejected = rejectOnce.checked
  if(wasRejected){
    await showDecline()
  } else {
    await runSequenceAndFinish(true,false)
  }
})

cancelPin.addEventListener('click',()=>{
  pinScreen.classList.remove('activeScreen'); pinScreen.classList.add('hidden'); pinScreen.setAttribute('aria-hidden','true')
  showDecline()
})

async function runSequenceAndFinish(accepted, isRejected){
  await sequentialLights()
  const seq = ['P≈ôij√≠m√°m','Odes√≠l√°m','P≈ôij√≠m√°m','Odes√≠l√°m']
  for(const s of seq){
    statusText.textContent = s
    await sleep(600)
  }
  lights.forEach(l=>l.classList.remove('on'))
  await sleep(120)
  if(isRejected){
    await showDecline()
    return
  }
  if(accepted){
    await showApproved()
    return
  } else {
    await showDecline()
    return
  }
}

async function sequentialLights(){
  lights.forEach(l=>l.classList.remove('on'))
  for(let i=0;i<lights.length;i++){
    lights[i].classList.add('on')
    await sleep(180)
  }
}

async function showApproved(){
  statusText.textContent = 'Schv√°leno'
  resultIcon.textContent = '‚úÖ'
  resultText.textContent = 'Schv√°leno'
  terminal.classList.remove('activeScreen'); terminal.classList.add('hidden'); terminal.setAttribute('aria-hidden','true')
  result.classList.add('activeScreen'); result.setAttribute('aria-hidden','false')
  await sleep(4000)
  cleanupAndReturn()
}

async function showDecline(){
  statusText.textContent = 'Platba zam√≠tnuta. Nedostatek z≈Østatku.'
  resultIcon.textContent = '‚ùå'
  resultText.textContent = 'Platba zam√≠tnuta'
  terminal.classList.remove('activeScreen'); terminal.classList.add('hidden'); terminal.setAttribute('aria-hidden','true')
  result.classList.add('activeScreen'); result.setAttribute('aria-hidden','false')
  await sleep(4000)
  cleanupAndReturn()
}

function cleanupAndReturn(){
  inProcess = false
  if(rejectOnce.checked) rejectOnce.checked = false
  result.classList.remove('activeScreen'); result.classList.add('hidden'); result.setAttribute('aria-hidden','true')
  menu.classList.remove('hidden'); menu.classList.add('activeScreen')
  statusText.textContent = 'P≈ôilo≈æte kartu k zadn√≠ stranƒõ telefonu'
  stopScan()
}
</script>
</body>
</html>
