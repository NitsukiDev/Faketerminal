<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fake NFC Terminál</title>
<style>
body { margin:0; font-family:Arial,sans-serif; background:#111; color:white; display:flex; justify-content:center; align-items:center; height:100vh; }
#menu, #terminal, #pinScreen, #result { display:none; flex-direction:column; align-items:center; justify-content:center; width:100%; max-width:400px; }
#menu.active, #terminal.active, #pinScreen.active, #result.active { display:flex; }
input[type=number] { width:100px; padding:5px; margin:5px; font-size:16px; }
label { margin:5px; font-size:14px; }
button { padding:10px 20px; margin:5px; font-size:16px; border:none; border-radius:5px; cursor:pointer; }
button#start { background:#00aa00; color:white; }
button#cancel { background:#aa0000; color:white; }
#lights { display:flex; justify-content:center; gap:10px; margin:20px; }
.l { width:20px; height:20px; background:#003300; border-radius:50%; }
.activeLight { background:#00ff00; box-shadow:0 0 10px #0f0; }
#status { font-size:20px; margin:10px; text-align:center; min-height:30px; }
#amountDisplay { font-size:28px; margin-bottom:10px; }
#numpad { display:grid; grid-template-columns: repeat(3, 60px); grid-gap:10px; margin-top:10px; }
.nbtn { background:#333; color:white; font-size:20px; border-radius:5px; cursor:pointer; }
#pinInput { font-size:24px; letter-spacing:5px; margin-bottom:10px; }
</style>
</head>
<body>

<div id="menu" class="active">
  <h2>Nastavení platby</h2>
  <label>Částka (CZK): <input type="number" id="amount" min="1" value="50"></label>
  <label><input type="checkbox" id="reject"> Zamítnout tuto platbu</label>
  <label><input type="checkbox" id="requirePin"> Vyžadovat PIN</label>
  <button id="start">Spustit terminál</button>
</div>

<div id="terminal">
  <div id="amountDisplay"></div>
  <div id="status">Přiložte kartou k NFC...</div>
  <div id="lights">
    <div class="l"></div><div class="l"></div><div class="l"></div><div class="l"></div>
  </div>
</div>

<div id="pinScreen">
  <div>Zadejte PIN</div>
  <div id="pinInput"></div>
  <div id="numpad">
    <button class="nbtn">1</button>
    <button class="nbtn">2</button>
    <button class="nbtn">3</button>
    <button class="nbtn">4</button>
    <button class="nbtn">5</button>
    <button class="nbtn">6</button>
    <button class="nbtn">7</button>
    <button class="nbtn">8</button>
    <button class="nbtn">9</button>
    <div></div>
    <button class="nbtn">0</button>
    <div></div>
  </div>
  <button id="cancel">Zrušit</button>
  <button id="confirm" style="background:#00aa00;color:white;">Pokračovat</button>
</div>

<div id="result">
  <div id="resultIcon" style="font-size:80px;"></div>
  <div id="resultText" style="font-size:24px; text-align:center; margin-top:10px;"></div>
</div>

<script>
const menu=document.getElementById('menu')
const terminal=document.getElementById('terminal')
const pinScreen=document.getElementById('pinScreen')
const resultScreen=document.getElementById('result')
const amountInput=document.getElementById('amount')
const rejectCheckbox=document.getElementById('reject')
const pinCheckbox=document.getElementById('requirePin')
const startBtn=document.getElementById('start')
const amountDisplay=document.getElementById('amountDisplay')
const statusText=document.getElementById('status')
const lights=document.querySelectorAll('.l')
const pinInput=document.getElementById('pinInput')
const numpadBtns=document.querySelectorAll('.nbtn')
const cancelBtn=document.getElementById('cancel')
const confirmBtn=document.getElementById('confirm')
const resultIcon=document.getElementById('resultIcon')
const resultText=document.getElementById('resultText')

let reject=false
let requirePin=false
let pinValue=''

startBtn.onclick=()=>{
  reject=rejectCheckbox.checked
  requirePin=pinCheckbox.checked
  menu.classList.remove('active')
  terminal.classList.add('active')
  amountDisplay.textContent=amountInput.value+' CZK'
  startNFC()
}

function sleep(ms){return new Promise(r=>setTimeout(r,ms))}

async function startNFC(){
  if(!("NDEFReader" in window)){statusText.textContent="Tento prohlížeč nepodporuje NFC";return}
  try{
    const ndef=new NDEFReader()
    await ndef.scan()
    statusText.textContent="Přiložte kartu..."
    ndef.onreading=()=>fakeProcess()
  }catch(e){statusText.textContent="Povolte NFC v nastavení"}
}

async function fakeProcess(){
  if(navigator.vibrate) navigator.vibrate(200)
  for(let i=0;i<lights.length;i++){
    lights[i].classList.add('activeLight')
    await sleep(200)
  }
  const steps=['Přijímám','Odesílám','Přijímám','Odesílám']
  for(const s of steps){
    statusText.textContent=s
    await sleep(400)
  }
  for(let l of lights) l.classList.remove('activeLight')
  if(reject){showResult(false)}
  else if(requirePin){showPinScreen()}
  else{showResult(true)}
}

function showPinScreen(){
  terminal.classList.remove('active')
  pinScreen.classList.add('active')
  pinValue=''
  updatePinDisplay()
}

numpadBtns.forEach(b=>{
  b.onclick=()=>{if(pinValue.length<4){pinValue+=b.textContent;updatePinDisplay()}}
})

function updatePinDisplay(){pinInput.textContent='*'.repeat(pinValue.length)}

cancelBtn.onclick=()=>{pinScreen.classList.remove('active');showResult(false)}
confirmBtn.onclick=()=>{pinScreen.classList.remove('active');showResult(true)}

function showResult(s){
  resultScreen.classList.add('active')
  if(s){resultIcon.textContent='✔️';resultText.textContent='Platba byla úspěšná.'}
  else{resultIcon.textContent='❌';resultText.textContent='Platba zamítnuta.'}
}
</script>

</body>
</html>